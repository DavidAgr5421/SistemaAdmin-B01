<html lang="es">
<head>
  <meta charset="UTF-8">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="assets/styles.css" rel="stylesheet">
  <title>Inventario</title>
</head>
<body>
  <!--OffCanvas Navbar-->
  <nav class="navbar navbar-dark bg-dark admin-header">
    <div class="container-fluid">
        <h1>Panel - Inventario</h1>
        <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#lateralNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <!--- OffCanvas Start -->   
        <section class="offcanvas offcanvas-end bg-dark" id="lateralNav" tabindex="-1">
            <div class="offcanvas-header" data-bs-theme="dark">
                <h5 class="offcanvas-title text-white">Paneles</h5>
                <button class="btn-close" type="button" aria-label="close" data-bs-dismiss="offcanvas"></button>
            </div>
            <!--- Links Menu --->
            <div class="offcanvas-body  d-flex flex-column justify-content-between px-0">
                <ul class="navbar-nav fs-5 justify-content-evenly">
                    <li class="nav-item p-3 py-md-1"><a class="nav-link" href="history.html">Perfil</a></li>
                    <li class="nav-item p-3 py-md-1"><a class="nav-link" href="factura.html">Realizar Factura</a></li>
                    <li class="nav-item p-3 py-md-1"><a class="nav-link" href="administrador.html">Historiales</a></li>
                    <li class="nav-item p-3 py-md-1"><a class="nav-link" href="users.html">Usuarios</a></li>
                    <li class="nav-item p-3 py-md-1"><a class="nav-link" href="">Cerrar Sesi√≥n</a></li>
                </ul>
            </div>

            <div class="d-lg-none align-self-center py-3">
                <a href=""><i class="bi bi-twitter"></i></a>
                <a href=""><i class="bi bi-facebook"></i></a>
            </div>
        </section>
        
    </div>
  </nav>
  <div class="form-container">
    <h2>Agregar Producto al Inventario</h2>

      <input class="entrybill" type="text" id="referencia" placeholder="Referencia">
      <input class="entrybill" type="number" id="cantidad" placeholder="Cantidad">
      <input class="entrybill" type="number" id="precio" placeholder="Precio">

    <select class="entrybill" id="talla">
      <option value="S">S</option>
      <option value="M">M</option>
      <option value="L">L</option>
      <option value="XL">XL</option>
      <option value="XXL">XXL</option>
      <option value="3XL">3XL</option>
      <option value="4XL">4XL</option>
    </select>
    <button class="btn btn-full btn-primary mb-3" onclick="agregarProducto()">Agregar al Carrito</button>

    <h3>Carrito</h3>
    <table class="mb-3 bill">
      <thead>
        <tr>
          <th>Referencia</th>
          <th>Cantidad</th>
          <th>Precio</th>
          <th>Talla</th>
          <th>Subtotal</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="carrito"></tbody>
    </table>
    <h4>Total: $<span id="total">0</span></h4>
    <button class="btn btn-dark" onclick="window.print()">Imprimir</button>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="cerrarModal()">&times;</span>
      <h3 class="text-center">Editar Producto</h3>
      <div class="input-group mb-3 d-flex flex-column text-center">
        <div class="form-floating">
          <input class="form-control" type="text" id="editReferencia" placeholder="Referencia">
          <label for="floatingInputGroup1">Referencia</label>
        </div>
        <div class="form-floating">
          <input class="form-control" type="number" id="editCantidad" placeholder="Cantidad">
          <label for="floatingInputGroup1">Cantidad</label>
        </div>
        <div class="form-floating">
          <input class="form-control" type="number" id="editPrecio" placeholder="Precio">
          <label for="floatingInputGroup1">Precio</label>
        </div>
        <select class="input-group-text mb-2" id="editTalla">
          <option value="S">S</option>
          <option value="M">M</option>
          <option value="L">L</option>
          <option value="XL">XL</option>
          <option value="XXL">XXL</option>
          <option value="3XL">3XL</option>
          <option value="4XL">4XL</option>
        </select>
      </div>
      <div class="d-flex align-self-center">
        <button class="btn btn-success rounded" onclick="guardarEdicion()" style="width: 100%;">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Observations Modal -->
  <div id="observeModal" class="modal">
    <div class="modal-dialog">
      <div class="modal-content">
        <span class="close" onclick="cerrarModalObservacion()">&times;</span>
        <h3>Observaciones</h3>
        <textarea id="observaciones" rows="4" style="width: 100%; margin: 10px 0;"></textarea>
        <button class="btn btn-primary" onclick="guardarObservacion()">Guardar Observaci√≥n</button>
      </div>
    </div>
    
  </div>

  <!-- Delete Modal -->

  <div id="deleteModal" class="modal">
    <div class="modal-content text-center">
      <h3>¬°Alerta!</h3>
      <p>¬øEst√°s seguro de eliminar este producto?</p>
      <div class="d-flex justify-content-evenly ">
        <button class="btn btn-dark" onclick="cerrarModaldelete()">Cancelar</button>
        <button class="btn btn-delete"  onclick="eliminar()">Eliminar</button>
      </div>
    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script>
    let carrito = [];
    let indiceEdicion = -1;

    function agregarProducto() {
      const referencia = document.getElementById('referencia').value;
      const cantidad = document.getElementById('cantidad').value;
      const precio = document.getElementById('precio').value;
      const talla = document.getElementById('talla').value;

      const producto = { 
        referencia, 
        cantidad: parseInt(cantidad), 
        precio: parseFloat(precio), 
        talla,
        observacion: ''
      };
      carrito.push(producto);
      actualizarCarrito();
      limpiarFormulario();
    }

    function limpiarFormulario() {
      document.getElementById('referencia').value = '';
      document.getElementById('cantidad').value = '';
      document.getElementById('precio').value = '';
      document.getElementById('talla').value = 'S';
    }

    function actualizarCarrito() {
      const tbody = document.getElementById('carrito');
      tbody.innerHTML = '';

      let total = 0;
      carrito.forEach((producto, index) => {
        const subtotal = producto.cantidad * producto.precio;
        total += subtotal;

        const fila = `
          <tr>
            <td>${producto.referencia}</td>
            <td>${producto.cantidad}</td>
            <td>${producto.precio}</td>
            <td>${producto.talla}</td>
            <td>${subtotal.toFixed(2)}</td>
            <td>
              <button class="btn-action btn-delete" onclick="eliminarProducto(${index})">üóëÔ∏è</button>
              <button class="btn-action btn-edit" onclick="editarProducto(${index})">‚úèÔ∏è</button>
              <button class="btn-action btn-observe" onclick="observarProducto(${index})">üìù</button>
            </td>
          </tr>
        `;
        tbody.innerHTML += fila;
      });

      document.getElementById('total').innerText = total.toFixed(2);
    }

    function eliminarProducto(index) {
      document.getElementById('deleteModal').style.display = 'block';
    }
    
    function cerrarModaldelete(){
      document.getElementById('deleteModal').style.display = 'none';
    }

    function eliminar(index){
      carrito.splice(index, 1);
      actualizarCarrito();
      cerrarModaldelete();
    }

    function editarProducto(index) {
      indiceEdicion = index;
      const producto = carrito[index];
      
      document.getElementById('editReferencia').value = producto.referencia;
      document.getElementById('editCantidad').value = producto.cantidad;
      document.getElementById('editPrecio').value = producto.precio;
      document.getElementById('editTalla').value = producto.talla;
      
      document.getElementById('editModal').style.display = 'block';
    }

    function cerrarModal() {
      document.getElementById('editModal').style.display = 'none';
      indiceEdicion = -1;
    }

    function guardarEdicion() {
      if(indiceEdicion === -1) return;
      
      carrito[indiceEdicion] = {
        referencia: document.getElementById('editReferencia').value,
        cantidad: parseInt(document.getElementById('editCantidad').value),
        precio: parseFloat(document.getElementById('editPrecio').value),
        talla: document.getElementById('editTalla').value,
        observacion: carrito[indiceEdicion].observacion || ''
      };
      
      actualizarCarrito();
      cerrarModal();
    }

    function observarProducto(index) {
      indiceEdicion = index;
      document.getElementById('observaciones').value = carrito[index].observacion || '';
      document.getElementById('observeModal').style.display = 'block';
    }

    function cerrarModalObservacion() {
      document.getElementById('observeModal').style.display = 'none';
      indiceEdicion = -1;
    }

    function guardarObservacion() {
      if(indiceEdicion === -1) return;
      
      carrito[indiceEdicion].observacion = document.getElementById('observaciones').value;
      cerrarModalObservacion();
    }
  </script>
</body>
</html>